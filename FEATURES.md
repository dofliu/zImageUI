# Z-Image-Turbo Web UI - 功能清單

## 🎉 已完成功能 (Phase 1 & 2)

### ✅ 第一階段：核心功能

#### 1. **批量生成模式** (Batch Generation)
**路徑**: `/batch-generate` API
**功能**:
- 單張/批量模式切換
- 每行一個提示詞輸入
- 最多支援 20 張批量生成
- 序列化處理避免 VRAM 爆炸
- 實時進度追蹤
- 網格展示所有結果
- 成功/失敗統計
- ZIP 批量下載
- 點擊縮圖查看大圖

**使用方式**:
1. 點擊「批量生成」切換模式
2. 每行輸入一個提示詞
3. 點擊「開始批量生成」
4. 查看網格結果
5. 點擊「下載全部 (ZIP)」批量下載

---

#### 2. **風格預設模板** (Style Templates)
**路徑**: `/templates` API, `templates.json`
**功能**:
- 50+ 專業風格模板
- 7 大分類體系
- 下拉選單快速選擇
- 自動組合到提示詞
- 刷新按鈕重新載入

**風格分類**:
1. **藝術風格** (6種): 水彩、油畫、素描、水墨、浮世繪、印象派
2. **現代風格** (5種): 賽博龐克、極簡、復古、蒸汽龐克、波普
3. **動漫風格** (5種): 吉卜力、日式、迪士尼、像素、漫畫
4. **攝影風格** (4種): 電影、黑白、HDR、微距
5. **教學模板** (5種): 科學圖解、歷史場景、文學插圖、地理景觀、信息圖表
6. **3D渲染** (3種): 寫實3D、低多邊形、黏土渲染
7. **特殊效果** (4種): 霓虹發光、水晶質感、金屬質感、夢幻光效

**使用方式**:
1. 在風格模板下拉選單中選擇風格
2. 輸入基礎提示詞
3. 系統自動組合風格關鍵字
4. 點擊生成

---

#### 3. **圖片尺寸預設** (Size Presets)
**路徑**: `/size-presets` API
**功能**:
- 15+ 常用尺寸預設
- 3 大類別
- VRAM 使用提示
- 動態尺寸選擇
- 自動調整生成參數

**尺寸分類**:
1. **社群媒體** (5種):
   - Instagram 正方形 (1080×1080)
   - Instagram 直式 (1080×1350)
   - Facebook 封面 (1200×630)
   - Twitter 卡片 (1200×675)
   - YouTube 縮圖 (1280×720)

2. **列印尺寸** (4種):
   - A4 直式 (2480×3508)
   - A4 橫式 (3508×2480)
   - A5 直式 (1748×2480)
   - 明信片 (1600×1200)

3. **標準尺寸** (5種):
   - 正方形 512 [VRAM: 低]
   - 正方形 768 [VRAM: 中]
   - 正方形 1024 [VRAM: 高]
   - 寬屏 16:9 (1024×576)
   - 直式 9:16 (576×1024)

**使用方式**:
1. 在尺寸選擇器中選擇預設尺寸
2. 注意 VRAM 使用提示
3. 點擊生成

---

### ✅ 第二階段：進階功能

#### 4. **標籤系統** (Tags System)
**API 路徑**:
- `/tags` - 獲取所有標籤
- `/history/<item_id>/tags` - 更新標籤
- `/history/filter` - 按標籤過濾

**功能**:
- 為歷史記錄添加標籤
- 標籤雲顯示
- 標籤使用頻率統計
- 點擊標籤過濾
- 多標籤組合過濾
- 動態標籤管理

**使用方式**:
1. 在歷史記錄項目中添加標籤
2. 查看標籤雲統計
3. 點擊標籤進行過濾
4. 清除過濾查看全部

**標籤範例**:
- `#風景` - 風景類圖片
- `#人物` - 人物肖像
- `#教學` - 教學用途
- `#專案A` - 特定專案
- `#實驗` - 實驗性作品

---

#### 5. **Seed 固定控制** (Seed Control)
**路徑**: `/seed-control` API
**功能**:
- 固定隨機種子
- 重現相同結果
- 隨機種子生成
- Seed 顯示與記錄
- 檔案名稱包含 Seed

**使用方式**:
1. 勾選「使用固定種子」
2. 輸入 Seed 或點擊🎲生成隨機 Seed
3. 使用相同 Seed 和提示詞可重現結果
4. 檔案名稱格式: `seed_{seed}_{timestamp}.png`

**應用場景**:
- 重現喜歡的結果
- A/B 測試不同提示詞
- 教學演示
- 調試優化

---

#### 6. **文字疊加功能** (Text Overlay) ✅ **完成**
**路徑**: `/add-text-overlay` API
**功能**:
- 在圖片上添加文字
- 支援中文字體 (微軟雅黑/微軟正黑體/宋體/黑體)
- 3 種位置選擇 (頂部/中間/底部)
- 2 種顏色選擇 (白色/黑色)
- 半透明背景遮罩 (增加可讀性)
- 折疊式編輯器 UI
- 可重複疊加多次文字
- 即時圖片更新

**使用方式**:
1. 生成圖片後，自動顯示「添加文字」編輯器
2. 輸入文字內容 (最多 100 字)
3. 選擇文字位置 (頂部/中間/底部)
4. 選擇文字顏色 (白色/黑色)
5. 勾選「背景遮罩」選項
6. 點擊「套用文字」按鈕
7. 生成帶文字的新圖片，自動添加到歷史記錄

**使用場景**:
- 教學教材標題製作
- 社群媒體圖文排版
- 簡報封面與內頁
- 圖片說明與註解
- 教育內容標注

**技術特點**:
- 使用 Pillow (PIL) 進行圖片處理
- 自動載入 Windows 系統中文字體
- 字體大小 48px (可調整)
- 文字自動水平置中
- 背景遮罩透明度 180/255
- 檔案命名格式: `text_overlay_{timestamp}.png`

---

#### 7. **批量導出功能** (Batch Export) ✅ **完成 (v2.2.0)**
**路徑**: `/export-pdf`, `/export-ppt` API
**功能**:
- 批量導出為 PDF 文檔
- 批量導出為 PowerPoint
- 多選模式 UI
- 導出對話框
- PDF 三種版面：單頁/雙欄/網格
- PPT 三種主題：簡潔/專業/教學
- 可選擇是否包含提示詞
- 自動生成帶時間戳的檔案名稱
- 下載進度顯示

**使用方式**:
1. 點擊「多選模式」按鈕啟用多選功能
2. 勾選要導出的圖片（支援全選/取消全選）
3. 點擊「導出」按鈕開啟導出對話框
4. 選擇導出格式（PDF 或 PPT）
5. 選擇版面/主題樣式
6. 輸入標題（選填）
7. 勾選「包含提示詞」選項（可選）
8. 點擊「開始導出」下載檔案

**使用場景**:
- 教學簡報製作
- 設計作品集整理
- 教材文檔編排
- 成果報告製作
- 批量歸檔與分享

**技術特點**:
- 使用 reportlab 生成 PDF
- 使用 python-pptx 生成 PowerPoint
- 支援圖片自動縮放與排版
- 提示詞說明文字自動換行
- 自動計算頁面佈局
- 檔案命名格式: `{title}_{timestamp}.pdf/pptx`

---

#### 8. **選擇性刪除功能** (Selective Delete) ✅ **完成 (v2.3.0)**
**路徑**: `/delete-images` API
**功能**:
- 批量刪除選定圖片
- 多選模式整合
- 刪除確認對話框
- 同步刪除檔案與歷史記錄
- 詳細操作結果反饋
- 自動重新載入歷史列表
- 紅色警告色系 UI

**使用方式**:
1. 點擊「多選模式」按鈕啟用多選功能
2. 勾選要刪除的圖片（支援全選/取消全選）
3. 點擊紅色「刪除」按鈕
4. 確認刪除操作（此操作無法復原）
5. 系統自動刪除檔案並更新歷史記錄
6. 顯示刪除結果統計（成功/失敗數量）

**使用場景**:
- 清理失敗或不滿意的生成結果
- 管理歷史記錄空間
- 移除測試或實驗性圖片
- 批量整理圖片庫

**技術特點**:
- 使用 `os.remove()` 安全刪除檔案
- 同步更新 `history.json` 記錄
- 錯誤處理與失敗統計
- 確認對話框防止誤刪
- 刪除中載入狀態顯示
- 操作完成後自動刷新界面

**安全機制**:
- 雙重確認對話框
- 明確警告「此操作無法復原」
- 詳細的成功/失敗反饋
- 紅色警告色系視覺提示

---

## 📁 文件結構

```
zImage/
├── app.py                          # Flask 主程式（v2.3）
├── config.py                       # 配置文件
├── templates.json                  # 風格模板資料庫
├── claude.md                       # 開發計劃
├── todo.md                         # 任務清單
├── FEATURES.md                     # 本文件
├── templates/
│   └── index.html                  # Web 介面（v2.3）
├── static/
│   ├── css/
│   │   └── style.css              # 樣式表（2400+ 行）
│   └── js/
│       ├── script.js              # 主腳本（已升級）
│       ├── templates.js           # 風格/尺寸選擇器
│       ├── advanced.js            # 進階功能（標籤/Seed）
│       ├── textOverlay.js         # 文字疊加功能
│       └── exportManager.js       # 批量導出/刪除功能（v2.2-v2.3）
└── generated_images/               # 生成圖片目錄
```

---

## 🎯 使用流程

### 基礎流程
1. 選擇生成模式（單張/批量）
2. 選擇風格模板（可選）
3. 選擇圖片尺寸（可選）
4. 輸入提示詞
5. 點擊生成
6. 查看結果
7. 下載圖片

### 進階流程
1. 啟用 Seed 控制
2. 設定固定 Seed
3. 生成圖片
4. 為圖片添加標籤
5. 使用標籤過濾查找
6. 重用 Seed 重現結果

---

## 🔧 技術特點

### 後端優化
- ✅ Sequential CPU Offload (0.7GB VRAM)
- ✅ Attention Slicing
- ✅ VAE Slicing
- ✅ 模型預載入
- ✅ GPU 快取自動清理
- ✅ 批量序列化處理

### 前端優化
- ✅ 模組化 JavaScript
- ✅ 響應式設計
- ✅ 實時預覽
- ✅ 錯誤處理
- ✅ 載入狀態顯示
- ✅ 美觀 UI 設計

---

## 📊 性能指標

| 項目 | 指標 |
|------|------|
| GPU 記憶體使用 | ~0.7GB |
| 系統 RAM 使用 | ~20GB (模型) |
| 單張生成時間 | 5-8 秒 (768×768) |
| 批量生成 | 支援最多 20 張 |
| 支援解析度 | 512-3508 像素 |
| 風格模板數量 | 50+ |
| 尺寸預設數量 | 15+ |
| API 端點數量 | 16 個 |
| JavaScript 模組 | 5 個 |
| 導出格式 | PDF + PowerPoint |
| 批量操作 | 導出 + 刪除 |

---

## 🚀 未來功能規劃

### 第三階段（部分完成）
- [x] **文字疊加功能** ✅
- [x] **批量導出 PDF/PPT** ✅
- [x] **選擇性刪除功能** ✅
- [ ] 提示詞智能助手
- [ ] 圖片編輯工具
- [ ] 背景移除
- [ ] 使用者系統

### 第四階段（長期）
- [ ] 多模型支援
- [ ] ControlNet 整合
- [ ] LoRA 模型
- [ ] API 對外開放
- [ ] 行動裝置 App
- [ ] 雲端同步

---

## 📝 更新日誌

### v2.3.0 (2025-12-02)
- ✅ **新增選擇性刪除功能**
  - 批量刪除選定圖片
  - 紅色刪除按鈕 UI (警告色系)
  - 刪除確認對話框 (防止誤刪)
  - 同步刪除檔案與歷史記錄
  - 詳細的成功/失敗統計反饋
  - 自動重新載入歷史列表
- ✅ **UI/UX 重大改進**
  - 修復導出對話框按鈕顏色問題 (更鮮明的紫色漸層)
  - 修復風格選擇器文字壓縮問題 (完整顯示)
  - 刷新按鈕改為絕對定位浮動
  - 按鈕尺寸與字體全面優化
  - 取消按鈕改為明顯灰色邊框設計
- ✅ 新增 `/delete-images` API 端點
- ✅ exportManager.js 增強 (新增 80+ 行刪除邏輯)
- ✅ 新增刪除按鈕 CSS 樣式 (35+ 行)
- ✅ 修復 CSS 樣式問題 (45+ 行優化)
- ✅ 總共 16 個 API 端點

### v2.2.0 (2025-12-02)
- ✅ **新增批量導出功能**
  - PDF 導出支援 (單頁/雙欄/網格 三種版面)
  - PowerPoint 導出支援 (簡潔/專業/教學 三種主題)
  - 多選模式與批量選擇 UI
  - 導出對話框與選項設定
  - 可選擇是否包含提示詞說明
  - 自動生成帶時間戳的檔案名稱
- ✅ 新增 exportManager.js 模組 (330+ 行)
- ✅ 新增 `/export-pdf` 和 `/export-ppt` API
- ✅ 新增 430+ 行 CSS 樣式
- ✅ 安裝 reportlab 和 python-pptx 套件
- ✅ **修復關鍵 Bug**
  - 修復 JavaScript 變數重複宣告導致生成按鈕失效的問題
  - 新增 DOM 元素存在性檢查,提升程式穩定性
  - 優化模組間變數共享機制
- ✅ 總共 15 個 API 端點

### v2.1.0 (2025-12-02)
- ✅ **新增文字疊加功能**
  - Pillow 圖片處理整合
  - 中文字體支援
  - 3 種位置 + 2 種顏色
  - 半透明背景遮罩
  - 折疊式編輯器 UI
- ✅ 新增 textOverlay.js 模組
- ✅ 新增 `/add-text-overlay` API
- ✅ 新增 200+ 行 CSS 樣式
- ✅ 總共 13 個 API 端點

### v2.0.0 (2025-12-01)
- ✅ 新增批量生成模式
- ✅ 新增 50+ 風格模板
- ✅ 新增 15+ 尺寸預設
- ✅ 新增標籤系統
- ✅ 新增 Seed 控制
- ✅ 優化 UI/UX
- ✅ 模組化代碼結構

### v1.0.0 (2025-11-30)
- ✅ 基礎 Web 介面
- ✅ 單張生成
- ✅ 歷史記錄
- ✅ VRAM 優化
- ✅ 側邊欄布局

---

**開發者**: Claude Code
**最後更新**: 2025-12-02
**版本**: v2.3.0
