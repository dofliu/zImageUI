# Z-Image-Turbo Web UI 開發計劃

## 專案概述
基於 Flask 的 AI 圖片生成 Web 應用，使用 Z-Image-Turbo 模型，專為 12GB VRAM 優化。

## 當前狀態 (v2.2.0 - 2025-12-02)
### v1.0 基礎功能
- ✅ 基礎 Web 介面完成
- ✅ 圖片生成功能完成
- ✅ 歷史記錄功能完成
- ✅ VRAM 優化完成 (Sequential CPU Offload)
- ✅ 側邊欄布局完成
- ✅ 已移除進度條功能
- ✅ GitHub 專案建立完成

### v2.0-v2.2 新增功能 (Phase 1-3 部分完成)
- ✅ 批量生成模式 (最多 20 張圖片)
- ✅ 風格模板系統 (50+ 專業風格，7 大分類)
- ✅ 尺寸預設系統 (15+ 常用尺寸)
- ✅ 標籤管理系統 (完整功能 - 後端 + 前端 UI)
- ✅ Seed 固定控制 (完整功能 - 後端 + 前端 UI)
- ✅ 文字疊加功能 (完整功能 - Pillow 整合)
- ✅ 批量導出功能 (PDF + PowerPoint)
- ✅ 模組化 JavaScript (5 個模組)
- ✅ 15 個 API 端點
- ✅ 完整文檔 (README, FEATURES, todo)
- ✅ 前端 UI 完全整合 (2300+ 行 CSS)
- ✅ 關鍵 Bug 修復 (變數重複宣告問題)

## 技術架構
**後端**: Flask + PyTorch + Diffusers
**前端**: Vanilla JavaScript + CSS Grid
**優化**: Sequential CPU Offload + Attention Slicing + VAE Slicing
**VRAM 使用**: ~0.7GB GPU + ~20GB RAM
**生成速度**: 5-8 秒/張 (768×768, 9 steps)

## 功能擴充計劃

### 第一階段: 核心增強功能 (優先實作)

#### 1. 批量生成模式 ⭐⭐⭐
**目標**: 一次生成多張圖片，特別適合教學製作教材
**功能**:
- 批量提示詞輸入 (一行一個)
- 序列化生成 (避免 VRAM 爆炸)
- 進度追蹤顯示
- 批量下載 (ZIP 打包)
- 命名規則設定

**技術實作**:
- 新增 `/batch-generate` API
- 前端新增批量輸入模式切換
- 使用佇列系統處理多個請求
- ZIP 壓縮輸出

#### 2. 風格預設模板 ⭐⭐⭐
**目標**: 快速選擇常用風格，降低使用門檻
**功能**:
- 預設風格庫 (水彩、油畫、賽博龐克、動漫、像素藝術等)
- 教學模板 (科學圖解、歷史場景、文學插圖)
- 風格收藏功能
- 自定義風格保存

**技術實作**:
- 建立 `templates.json` 風格資料庫
- 前端新增風格選擇器 UI
- 提示詞自動組合功能
- 用戶自定義模板儲存

#### 3. 標籤與分類系統 ⭐⭐
**目標**: 組織歷史記錄，方便查找
**功能**:
- 為圖片添加標籤
- 標籤過濾與搜索
- 分類資料夾 (專案、教學、個人等)
- 批量標籤操作

**技術實作**:
- 擴充 `history.json` 結構加入 tags 欄位
- 新增 `/tags` API (CRUD)
- 前端標籤選擇器和過濾器
- 標籤雲視覺化

#### 4. 圖片尺寸預設 ⭐⭐⭐
**目標**: 快速生成社群媒體適用尺寸
**功能**:
- Instagram 正方形 (1080×1080)
- Facebook 封面 (1200×630)
- YouTube 縮圖 (1280×720)
- Twitter 卡片 (1200×675)
- A4 列印 (適合教材)
- 自定義尺寸

**技術實作**:
- 擴充 `config.py` 尺寸預設
- 前端尺寸選擇器
- 動態調整生成參數
- 自適應 VRAM 警告

### 第二階段: 教學應用增強

#### 5. 文字疊加功能 ⭐⭐
**目標**: 在圖片上添加標題和說明文字
**功能**:
- 標題文字輸入
- 字體、大小、顏色選擇
- 位置調整 (上、中、下)
- 背景半透明遮罩
- 多語言字體支援

**技術實作**:
- 使用 Pillow (PIL) ImageDraw
- 字體庫整合 (Noto Sans TC)
- 前端文字編輯器
- 即時預覽

#### 6. 批量導出功能 ⭐⭐ ✅ **完成 (v2.2.0)**
**目標**: 將多張圖片整理成文檔
**功能**:
- 導出為 PDF (多頁) ✅
- 導出為 PowerPoint ✅
- 添加圖片說明 ✅
- 自動編號與排版 ✅
- 三種 PDF 版面配置 ✅
- 三種 PPT 主題風格 ✅

**技術實作**:
- 使用 `reportlab` 生成 PDF ✅
- 使用 `python-pptx` 生成 PPT ✅
- 模板系統 ✅
- 前端多選 UI ✅

#### 7. 提示詞智能助手 ⭐⭐⭐
**目標**: 協助用戶寫出更好的提示詞
**功能**:
- 提示詞建議與自動完成
- 風格關鍵字推薦
- 提示詞優化 (使用 LLM API)
- 範例提示詞庫
- 提示詞歷史記錄

**技術實作**:
- 整合 OpenAI API 或 Claude API (可選)
- 本地關鍵字資料庫
- 自動完成下拉選單
- 提示詞範本庫

### 第三階段: 進階功能

#### 8. Seed 固定與參數控制 ⭐⭐
**目標**: 精確控制生成結果
**功能**:
- 固定隨機種子
- 重現相同結果
- 參數滑桿 (steps, guidance)
- 參數組合保存

#### 9. 圖片編輯與後製 ⭐⭐
**目標**: 一站式圖片處理
**功能**:
- 裁切、旋轉
- 亮度、對比度、飽和度調整
- 濾鏡效果
- 背景移除 (使用 rembg)

#### 10. 使用者系統 ⭐
**目標**: 多用戶支援
**功能**:
- 註冊/登入
- 個人圖片庫
- 使用配額管理
- 偏好設定儲存

## 開發優先順序

### 立即開始 (本次開發)
1. ✅ 批量生成模式
2. ✅ 風格預設模板
3. ✅ 圖片尺寸預設
4. ✅ 標籤系統基礎

### 下一階段
- 提示詞智能助手
- 圖片編輯工具
- 背景移除功能

### 未來規劃
- 圖片編輯工具
- 使用者系統
- API 對外開放

## 技術注意事項

### VRAM 限制考量
- 批量生成必須序列化，避免 OOM
- 大尺寸圖片需要警告 VRAM 可能不足
- 提供快速模式 (降低解析度)

### 效能優化
- 模型保持在記憶體中 (已實作)
- 生成任務使用背景線程
- 大文件導出使用異步處理

### 安全性
- 提示詞過濾 (避免不當內容)
- 上傳檔案大小限制
- API 頻率限制 (未來)

## 測試計劃
- 單圖生成測試
- 批量生成壓力測試
- 不同尺寸 VRAM 佔用測試
- 多風格模板測試
- 導出功能測試

## 文檔更新
- 更新 README.md 新增功能說明
- 新增使用教學文檔
- API 文檔 (未來)

## 參考資源
- Diffusers 文檔: https://huggingface.co/docs/diffusers
- Z-Image-Turbo 模型: https://huggingface.co/Tongyi-MAI/Z-Image-Turbo
- Flask 文檔: https://flask.palletsprojects.com/
- Pillow 文檔: https://pillow.readthedocs.io/
